mimir-distributed:
  # Predictable resource names (SA = "mimir", gateway svc = "mimir-gateway").
  fullnameOverride: mimir

  # Single-tenant mode — no X-Scope-OrgID header required.
  mimir:
    structuredConfig:
      multitenancy_enabled: false

      # Disable Kafka-based ingest storage (default in chart 6.x) to use the
      # classic distributor → ingester write path.
      ingest_storage:
        enabled: false
      ingester:
        push_grpc_method_enabled: true

      # Azure Blob backend is configured here as a fallback; Terraform injects
      # the real account_name and container_name via ArgoCD Application
      # helm.values, so the values below act as documentation/defaults.
      common:
        storage:
          backend: azure
          azure:
            account_name: "INJECTED_BY_TERRAFORM"
            container_name: "mimir-data"

      limits:
        max_global_series_per_user: 0
        max_global_series_per_metric: 0
        ingestion_rate: 0
        ingestion_burst_size: 0

  # Disable bundled Kafka (not needed without ingest storage).
  kafka:
    enabled: false

  # Disable bundled MinIO — we use Azure Blob Storage.
  minio:
    enabled: false

  # --- Minimal replicas for a learning / dev environment ---
  distributor:
    replicas: 1
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule
  ingester:
    replicas: 2
    zoneAwareReplication:
      enabled: false
    persistentVolume:
      size: 5Gi
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule
  querier:
    replicas: 1
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule
  query_frontend:
    replicas: 1
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule
  store_gateway:
    replicas: 1
    zoneAwareReplication:
      enabled: false
    persistentVolume:
      size: 5Gi
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule
  compactor:
    replicas: 1
    persistentVolume:
      size: 5Gi
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule
  ruler:
    enabled: false
  alertmanager:
    enabled: false
  overrides_exporter:
    enabled: false

  # Gateway (nginx reverse proxy) — single entry point for writes and reads.
  gateway:
    replicas: 1
    nodeSelector:
      workload: monitoring
    tolerations:
      - key: workload
        operator: Equal
        value: monitoring
        effect: NoSchedule

  # Disable rollout-operator (not needed at this scale).
  rollout_operator:
    enabled: false

  # ServiceAccount annotations are injected by Terraform (Workload Identity
  # client-id); the section below ensures the SA is created.
  serviceAccount:
    create: true
    annotations: {}

  # Workload Identity label on all pods so Azure AD token projection works.
  global:
    podLabels:
      "azure.workload.identity/use": "true"
